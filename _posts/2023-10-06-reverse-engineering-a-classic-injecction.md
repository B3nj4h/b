---
layout: post
title: Reverse Engineering - A Classic Injecction
date: '2023-10-06 12:26:52 +0300'
image: /assets/img/cover_images/12.png
categories: [BTLO, Reverse Engineering]
tags: [BTLO, Reverse Engineering, Sysinternals, Powershell, Radare2, Ghidra]
---

## Reverse Engineering - A Classic Injection
Analyse the attached EXE sample and find answers to the following questions.
Note: The EXE uses shellcode generated by the Metasploit attack framework. Make sure you analyse the sample in contained environment (we recommend a virtual machine where internet access is disabled). 

## What is the name of the compiler used to generate the EXE? 

We use peframe and find the compiler used was Microsoft Visual C++
```bash
peframe analyseme.exe
```

## This malware, when executed, sleeps for some time. What is the sleep time in minutes?

We open the file with ghidra.Find the sleep time and convert it to minutes 

![img-description](/assets/img/reverse-classic-injection/1.png)

## After the sleep time, it prompts for user password, what is the correct password?

We open the file with radare2 and try to analyze it. We find the correct password from the assembly code

![img-description](/assets/img/reverse-classic-injection/2.png)

## What is the size of the shellcode?

We can see the size of the shell code from the assembly code

![img-description](/assets/img/reverse-classic-injection/4.png)

## Shellcode injection involves three important windows API. What is the name of the API Call used?

I did some research and came across [this](https://www.solomonsklash.io/syscalls-for-shellcode-injection.html). I looked for an API from the one listed above and i found this

![img-description](/assets/img/reverse-classic-injection/5.png)

## What is the name of the victim process? 

We can see the victim process from the code below

![img-description](/assets/img/reverse-classic-injection/3.png)

## What is the file created by the sample 

We need to do some dynamic analysis of the malware. I run the malware on a virtual machine and it created a file and stored it at

```powershell
C:\Windows\Temp\btlo.txt
```

## What is the message in the created file 

We read the content of the file using a powershell command
```powershell
PS C:\> Get-Content C:\Windows\Temp\btlo.txt
Welcome to BTLO!
```

## What is the program that the shellcode used to create and write this file

Taking a look at the shellcode that run the command from ProcMon we see a PowerShell process. So the program was powershell.exe